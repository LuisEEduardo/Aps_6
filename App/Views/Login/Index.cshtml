<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>WebcamJS - Captura Imagem</title>
    <link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <style type="text/css">
        body {
            font-family: Helvetica, sans-serif;
        }

        h2,
        h3 {
            margin-top: 0;
        }

        form {
            margin-top: 15px;
        }

            form > input {
                margin-right: 15px;
            }

        #buttonhide {
            background: transparent;
            border: none !important;
            font-size: 0;
        }
    </style>
</head>

<body class="container">
    <br />

    <div class="col-md-6 align-content-center">
        <div class="panel panel-default">
            <div class="panel-body">
                <div id="mac_camera"></div>
                <!-- botão para tirar foto -->
                <form>
                    <input id="btnTirarFoto" type="button" class="btn btn-success" value="Capturar Imagem" onClick="captura_imagem()">
                </form>
            </div>
        </div>
    </div>

    @*<div class="col-md-6">
    <div class="panel panel-default">
    <div class="panel-heading">Foto Capturada</div>
    @*<div class="panel-body">
    <div id="resultado">Sua imagem capturada vai aparecer aqui.</div>
    </div>
    <br />
    <br />
    </div>
    </div>*@

    <!-- inclui a livraria javascript -->
    <script src="~/webcamjs/webcam.js"></script>
    <!-- Configura e anexa a camera -->
    <script language="JavaScript">
        Webcam.set({
            width: 400,
            height: 300,
            image_format: 'jpeg',
            jpeg_quality: 90
        });
        Webcam.attach('#mac_camera');
    </script>
    <!-- Codigo para tirar a foto e exibir localmente -->
    <script language="JavaScript">
        function captura_imagem() {
            // tira a foto e obtem os dados da imagem
            Webcam.snap(function(data_uri) {
                // exibe o resultado na pagina
                //document.getElementById('resultado').innerHTML =
                //    '<img src="' + data_uri + '"/>';
                Webcam.upload(data_uri, '/Login/CapturaImagem', function(code, data) {
                    console.log(data);
                    //return fetch('/Home/Index', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: data }); // body: JSON.stringify(data)
                    fetch('/Home/Index', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: data })
                        .then((data) => {
                            console.log(data)
                        });
                    //EnviarDados(data)
                })
                Webcam.reset();
                Webcam.off();
            });



            var btn = document.querySelector("#btnTirarFoto");

            btn.disabled = true;
        };

        function EnviarDados(urlImg) {
            fetch('/Home/Index', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: urlImg })
                .then((data) => {
                    console.log('Chegou', data)

                })
                .catch((error) => {
                    console.log('Error:', error)
                }); // body: JSON.stringify(data)
        }

    </script>
</body>

</html>